import random
import math

class GraphColoringSA:
    def __init__(self, num_vertices=10, edges=None):
        self.num_vertices = num_vertices
        self.edges = edges if edges else []
        self.adj_list = self._build_adj_list()
    
    def _build_adj_list(self):
        """Построить список смежности графа."""
        adj_list = [[] for _ in range(self.num_vertices)]
        for u, v in self.edges:
            adj_list[u].append(v)
            adj_list[v].append(u)
        return adj_list

    def count_conflicts(self, coloring):
        """Подсчитать число конфликтов (смежных вершин с одинаковым цветом)."""
        conflicts = 0
        for u, v in self.edges:
            if coloring[u] == coloring[v]:
                conflicts += 1
        return conflicts

    def generate_neighbor(self, coloring):
        """Сгенерировать соседнее решение: изменить цвет одной случайной вершины."""
        new_coloring = coloring[:]
        vertex = random.randint(0, self.num_vertices - 1)

        # Собрать цвета соседей
        neighbor_colors = {new_coloring[neighbor] for neighbor in self.adj_list[vertex]}

        # Доступные цвета: все, кроме цветов соседей
        max_color = max(new_coloring)
        available_colors = [c for c in range(max_color + 1) if c not in neighbor_colors]

        if available_colors:
            # Выбираем случайный доступный цвет
            new_coloring[vertex] = random.choice(available_colors)
        else:
            # Если нет доступных цветов — добавляем новый
            new_coloring[vertex] = max_color + 1

        return new_coloring

    def simulated_annealing(self, initial_temp=100.0, cooling_rate=0.95, min_temp=0.1, max_iter_per_temp=10):
        """
        Алгоритм имитации отжига для раскраски графа.
        
        Параметры:
        - initial_temp: начальная температура
        - cooling_rate: коэффициент охлаждения (0 < rate < 1)
        - min_temp: минимальная температура (критерий остановки)
        - max_iter_per_temp: число итераций на каждом уровне температуры
        """
        # Начальное решение: каждая вершина — свой цвет
        current_coloring = list(range(self.num_vertices))
        current_conflicts = self.count_conflicts(current_coloring)
        best_coloring = current_coloring[:]
        best_conflicts = current_conflicts

        temp = initial_temp

        print(f"Начальная температура: {temp:.2f}")
        print(f"Начальное число конфликтов: {current_conflicts}")

        while temp > min_temp:
            for _ in range(max_iter_per_temp):
                # Генерируем соседнее решение
                new_coloring = self.generate_neighbor(current_coloring)
                new_conflicts = self.count_conflicts(new_coloring)

                # Изменение числа конфликтов
                delta = new_conflicts - current_conflicts

                # Принимаем новое решение, если:
                # 1. Оно лучше (меньше конфликтов)
                # 2. Или с вероятностью exp(-delta / temp) при ухудшении
                if delta <= 0 or random.random() < math.exp(-delta / temp):
                    current_coloring = new_coloring
                    current_conflicts = new_conflicts

                    # Обновляем лучшее найденное решение
                    if new_conflicts < best_conflicts:
                        best_coloring = new_coloring[:]
                        best_conflicts = new_conflicts

            # Понижаем температуру
            temp *= cooling_rate

            # Выводим текущее состояние
            print(f"Температура: {temp:.2f}, Конфликтов: {current_conflicts}")

        return best_coloring, best_conflicts

    def get_num_colors(self, coloring):
        """Возвращает количество использованных цветов."""
        return len(set(coloring))



def main():
    print("Раскраска графа методом имитации отжига")
    print("Граф: 10 вершин, 15 рёбер")
    print("Введите 15 рёбер — пары вершин от 0 до 9 (через пробел)")
    print("Пример ввода: 0 1 (ребро между вершинами 0 и 1)\n")

    edges = []
    for i in range(15):
        while True:
            try:
                line = input(f"Ребро {i+1}/15: ").strip()
                if not line:
                    print("Строка не может быть пустой. Попробуйте снова.")
                    continue
                u, v = map(int, line.split())
                if u == v:
                    print("Ребро не может соединять вершину саму с собой. Попробуйте снова.")
                    continue
                if not (0 <= u <= 9 and 0 <= v <= 9):
                    print("Вершины должны быть от 0 до 9. Попробуйте снова.")
                    continue
                edges.append((u, v))
                break
            except ValueError:
                print("Ошибка: введите два целых числа через пробел. Попробуйте снова.")

    # Создаём экземпляр алгоритма
    graph = GraphColoringSA(num_vertices=10, edges=edges)

    print("\nЗапуск имитации отжига...")
    best_coloring, final_conflicts = graph.simulated_annealing(
        initial_temp=100.0,
        cooling_rate=0.95,
        min_temp=0.1,
        max_iter_per_temp=10
    )

    num_colors = graph.get_num_colors(best_coloring)

    print("\nРЕЗУЛЬТАТ:")
    print(f"Раскраска вершин: {best_coloring}")
    print(f"Количество использованных цветов: {num_colors}")
    print(f"Окончательное число конфликтов: {final_conflicts}")

    print("\nПодробная раскраска:")
    for vertex, color in enumerate(best_coloring):
        print(f"  Вершина {vertex}: цвет {color}")



if __name__ == "__main__":
    main()











Раскраска графа методом имитации отжига
Граф: 10 вершин, 15 рёбер
Введите 15 рёбер — пары вершин от 0 до 9 (через пробел)
Пример ввода: 0 1 (ребро между вершинами 0 и 1)

Ребро 1/15: 1 5
Ребро 2/15: 2 8
Ребро 3/15: 4 7
Ребро 4/15: 9 3
Ребро 5/15: 7 4
Ребро 6/15: 8 7
Ребро 7/15: 7 4
Ребро 8/15: 3 9
Ребро 9/15: 6 1
Ребро 10/15: 2 5
Ребро 11/15: 3 4
Ребро 12/15: 8 4
Ребро 13/15: 5 3
Ребро 14/15: 2 4
Ребро 15/15: 6 5

Запуск имитации отжига...
Начальная температура: 100.00
Начальное число конфликтов: 0
Температура: 95.00, Конфликтов: 0
Температура: 90.25, Конфликтов: 0
Температура: 85.74, Конфликтов: 0
Температура: 81.45, Конфликтов: 0
Температура: 77.38, Конфликтов: 0
Температура: 73.51, Конфликтов: 0
Температура: 69.83, Конфликтов: 0
Температура: 66.34, Конфликтов: 0
Температура: 63.02, Конфликтов: 0
Температура: 59.87, Конфликтов: 0
Температура: 56.88, Конфликтов: 0
Температура: 54.04, Конфликтов: 0
Температура: 51.33, Конфликтов: 0
Температура: 48.77, Конфликтов: 0
Температура: 46.33, Конфликтов: 0
Температура: 44.01, Конфликтов: 0
Температура: 41.81, Конфликтов: 0
Температура: 39.72, Конфликтов: 0
Температура: 37.74, Конфликтов: 0
Температура: 35.85, Конфликтов: 0
Температура: 34.06, Конфликтов: 0
Температура: 32.35, Конфликтов: 0
Температура: 30.74, Конфликтов: 0
Температура: 29.20, Конфликтов: 0
Температура: 27.74, Конфликтов: 0
Температура: 26.35, Конфликтов: 0
Температура: 25.03, Конфликтов: 0
Температура: 23.78, Конфликтов: 0
Температура: 22.59, Конфликтов: 0
Температура: 21.46, Конфликтов: 0
Температура: 20.39, Конфликтов: 0
Температура: 19.37, Конфликтов: 0
Температура: 18.40, Конфликтов: 0
Температура: 17.48, Конфликтов: 0
Температура: 16.61, Конфликтов: 0
Температура: 15.78, Конфликтов: 0
Температура: 14.99, Конфликтов: 0
Температура: 14.24, Конфликтов: 0
Температура: 13.53, Конфликтов: 0
Температура: 12.85, Конфликтов: 0
Температура: 12.21, Конфликтов: 0
Температура: 11.60, Конфликтов: 0
Температура: 11.02, Конфликтов: 0
Температура: 10.47, Конфликтов: 0
Температура: 9.94, Конфликтов: 0
Температура: 9.45, Конфликтов: 0
Температура: 8.97, Конфликтов: 0
Температура: 8.53, Конфликтов: 0
Температура: 8.10, Конфликтов: 0
Температура: 7.69, Конфликтов: 0
Температура: 7.31, Конфликтов: 0
Температура: 6.94, Конфликтов: 0
Температура: 6.60, Конфликтов: 0
Температура: 6.27, Конфликтов: 0
Температура: 5.95, Конфликтов: 0
Температура: 5.66, Конфликтов: 0
Температура: 5.37, Конфликтов: 0
Температура: 5.10, Конфликтов: 0
Температура: 4.85, Конфликтов: 0
Температура: 4.61, Конфликтов: 0
Температура: 4.38, Конфликтов: 0
Температура: 4.16, Конфликтов: 0
Температура: 3.95, Конфликтов: 0
Температура: 3.75, Конфликтов: 0
Температура: 3.56, Конфликтов: 0
Температура: 3.39, Конфликтов: 0
Температура: 3.22, Конфликтов: 0
Температура: 3.06, Конфликтов: 0
Температура: 2.90, Конфликтов: 0
Температура: 2.76, Конфликтов: 0
Температура: 2.62, Конфликтов: 0
Температура: 2.49, Конфликтов: 0
Температура: 2.36, Конфликтов: 0
Температура: 2.25, Конфликтов: 0
Температура: 2.13, Конфликтов: 0
Температура: 2.03, Конфликтов: 0
Температура: 1.93, Конфликтов: 0
Температура: 1.83, Конфликтов: 0
Температура: 1.74, Конфликтов: 0
Температура: 1.65, Конфликтов: 0
Температура: 1.57, Конфликтов: 0
Температура: 1.49, Конфликтов: 0
Температура: 1.42, Конфликтов: 0
Температура: 1.35, Конфликтов: 0
Температура: 1.28, Конфликтов: 0
Температура: 1.21, Конфликтов: 0
Температура: 1.15, Конфликтов: 0
Температура: 1.10, Конфликтов: 0
Температура: 1.04, Конфликтов: 0
Температура: 0.99, Конфликтов: 0
Температура: 0.94, Конфликтов: 0
Температура: 0.89, Конфликтов: 0
Температура: 0.85, Конфликтов: 0
Температура: 0.81, Конфликтов: 0
Температура: 0.77, Конфликтов: 0
Температура: 0.73, Конфликтов: 0
Температура: 0.69, Конфликтов: 0
Температура: 0.66, Конфликтов: 0
Температура: 0.62, Конфликтов: 0
Температура: 0.59, Конфликтов: 0
Температура: 0.56, Конфликтов: 0
Температура: 0.53, Конфликтов: 0
Температура: 0.51, Конфликтов: 0
Температура: 0.48, Конфликтов: 0
Температура: 0.46, Конфликтов: 0
Температура: 0.44, Конфликтов: 0
Температура: 0.41, Конфликтов: 0
Температура: 0.39, Конфликтов: 0
Температура: 0.37, Конфликтов: 0
Температура: 0.35, Конфликтов: 0
Температура: 0.34, Конфликтов: 0
Температура: 0.32, Конфликтов: 0
Температура: 0.30, Конфликтов: 0
Температура: 0.29, Конфликтов: 0
Температура: 0.27, Конфликтов: 0
Температура: 0.26, Конфликтов: 0
Температура: 0.25, Конфликтов: 0
Температура: 0.24, Конфликтов: 0
Температура: 0.22, Конфликтов: 0
Температура: 0.21, Конфликтов: 0
Температура: 0.20, Конфликтов: 0
Температура: 0.19, Конфликтов: 0
Температура: 0.18, Конфликтов: 0
Температура: 0.17, Конфликтов: 0
Температура: 0.16, Конфликтов: 0
Температура: 0.16, Конфликтов: 0
Температура: 0.15, Конфликтов: 0
Температура: 0.14, Конфликтов: 0
Температура: 0.13, Конфликтов: 0
Температура: 0.13, Конфликтов: 0
Температура: 0.12, Конфликтов: 0
Температура: 0.11, Конфликтов: 0
Температура: 0.11, Конфликтов: 0
Температура: 0.10, Конфликтов: 0
Температура: 0.10, Конфликтов: 0

РЕЗУЛЬТАТ:
Раскраска вершин: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
Количество использованных цветов: 10
Окончательное число конфликтов: 0

Подробная раскраска:
  Вершина 0: цвет 0
  Вершина 1: цвет 1
  Вершина 2: цвет 2
  Вершина 3: цвет 3
  Вершина 4: цвет 4
  Вершина 5: цвет 5
  Вершина 6: цвет 6
  Вершина 7: цвет 7
  Вершина 8: цвет 8
  Вершина 9: цвет 9